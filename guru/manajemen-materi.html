<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manajemen Materi - Portal Guru</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style> body { font-family: 'Inter', sans-serif; } </style>
</head>
<body>
    
    <!-- KONTEN INTI UNTUK HALAMAN INI -->
    <div class="p-6">
        <div class="mb-6 flex justify-end">
            <a href="tambah-materi.html" class="inline-block bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-300 shadow-md">
                + Tambah Materi Baru
            </a>
        </div>
        <div class="bg-white p-6 rounded-lg shadow">
            <h3 class="font-bold text-xl mb-4 text-gray-800">Daftar Materi Anda</h3>
            <div id="materi-list" class="space-y-4">
                <p id="loading-materi" class="text-gray-500">Memuat materi...</p>
            </div>
        </div>
    </div>

    <!-- Panggil Layout & Skrip Halaman -->
    <script type="module" src="../js/layout.js"></script>
    <script type="module">
        import { supabase } from '../js/supabase-client.js';

        const materiListContainer = document.getElementById('materi-list');
        const loadingMateriElement = document.getElementById('loading-materi');

        async function handleDelete(materiId) {
            if (confirm('Apakah Anda yakin ingin menghapus materi ini?')) {
                const { error } = await supabase.from('materi').delete().eq('id', materiId);
                
                if (error) {
                    alert('Gagal menghapus materi: ' + error.message);
                } else {
                    await fetchAndDisplayMateri();
                }
            }
        }

        async function fetchAndDisplayMateri() {
            loadingMateriElement.style.display = 'block';
            materiListContainer.innerHTML = '';
            materiListContainer.appendChild(loadingMateriElement);

            const { data: materi, error } = await supabase
                .from('materi')
                .select('*')
                .order('created_at', { ascending: false });

            loadingMateriElement.style.display = 'none';

            if (error) {
                materiListContainer.innerHTML = `<p class="text-red-500">Gagal memuat materi: ${error.message}</p>`;
                return;
            }

            if (materi.length === 0) {
                materiListContainer.innerHTML = '<p class="text-gray-500">Anda belum menambahkan materi apapun.</p>';
            } else {
                materi.forEach(item => {
                    const materiCard = document.createElement('div');
                    materiCard.className = 'bg-white p-4 rounded-lg shadow border flex justify-between items-center';
                    materiCard.innerHTML = `
                        <div>
                            <h4 class="font-bold text-gray-800">${item.judul}</h4>
                            <p class="text-sm text-gray-600">${item.deskripsi_singkat || ''}</p>
                        </div>
                        <div class="flex space-x-3 flex-shrink-0">
                            <a href="edit-materi.html?id=${item.id}" class="text-sm text-blue-500 hover:underline font-semibold">Edit</a>
                            <button data-id="${item.id}" class="delete-button text-sm text-red-500 hover:underline font-semibold">Hapus</button>
                        </div>
                    `;
                    materiListContainer.appendChild(materiCard);
                    
                    materiCard.querySelector('.delete-button').addEventListener('click', () => {
                        handleDelete(item.id);
                    });
                });
            }
        }

        // Fungsi ini akan dipanggil setelah layout siap
        function initializePage() {
            fetchAndDisplayMateri();
        }

        // Tunggu sinyal dari layout.js sebelum menjalankan skrip halaman ini
        document.addEventListener('layoutReady', initializePage);
    </script>
</body>
</html>
